# Install Custom Ressource Definitions?
installCRDs: false

# Default values that are used for creating ArgoCD `Application` definitions
defaults:
  project: "test"
  server: https://kubernetes.default.svc
  automated:
    prune: true
    selfHeal: false

# Heqet Functions / Injectors:
generators:
  # VaultSecret Generator for the vault-secrets-operator
  vault: false

  # NetworkPolicy Generator
  # Generates Ingress/Egress NetworkPolicy on Application Namespaces
  # Default: Deny all traffic in & out !
  netpolicy:
    enabled: true

    defaults:
      # Isolate Apps / Deny all traffic from/to apps by default
      ingress:
      # Allow traffic from Ingress Controller
      - from:
        - namespaceSelector: {}
          podSelector:
            matchLabels:
              app: traefik

        # Isolate Namespace / Allow communication in Namespace
        - podSelector: {}
      # Allow DNS
      egress:
        - ports:
          - port: 53
        - to:
          - namespaceSelector: {}

# App Definitions that will be managed in ArgoCD
apps:
  # Heqet
  - name: heqet-dev2
    path: .
    repoURL: https://github.com/nold360/heqet
    targetRevision: devel
    syncWave: "-1"

  - name: ghost2
    repoURL: https://charts.bitnami.com/bitnami
    chart: ghost
    targetRevision: 13.0.5
    allow:
      fromApps:
        - argocd
      ingress:
        - 2368 #Healthcheck?
    parameters:
      - name: ingress.enabled
        value: "true"
      - name: ingress.hostname
        value: ghost.k3s
      - name: service.type
        value: ClusterIP

  - name: dokuwiki2
    repoURL: https://charts.bitnami.com/bitnami
    chart: dokuwiki
    targetRevision: 11.1.6
    parameters:
      - name: ingress.enabled
        value: "true"
      - name: ingress.hostname
        value: doku.k3s
      - name: service.type
        value: ClusterIP
    allow:
      egress:
        - 80
        - 443
